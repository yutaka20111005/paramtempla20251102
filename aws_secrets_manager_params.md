# AWS Secrets Manager 構築パラメータシート

## 基本情報

| 項目 | 設定値 | 備考 |
|------|--------|------|
| リージョン | ap-northeast-1 (Tokyo) | 東京リージョン |
| 環境 | Production / Staging / Development | 環境に応じて選択 |
| 作成日 | YYYY-MM-DD | 構築実施日を記載 |

---

## シークレット設定

### ①Aurora PostgreSQL Serverless v2 DB認証情報

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **シークレット名** | `aurora-postgres-serverless-db-credential` | 命名規則: `{service}-{database}-{purpose}` 形式を推奨 |
| **説明 (Description)** | Aurora PostgreSQL Serverless v2 database access credentials | シークレットの用途を明確に記載 |
| **シークレットタイプ** | RDS database credentials | RDS用の認証情報を選択 |
| **データベースエンジン** | Amazon Aurora PostgreSQL | プルダウンから選択 |
| **認証情報の設定方法** | Manual / Auto-generate | 手動入力または自動生成を選択 |
| **ユーザー名** | `admin` または任意 | マスターユーザー名を指定 |
| **パスワード** | 自動生成 または 手動入力 | 最小8文字、英数字記号を含む複雑なパスワードを推奨 |
| **暗号化キー** | `aws/secretsmanager` (デフォルト) または カスタムKMSキー | カスタムKMS使用時はKMS Key IDを指定 |
| **データベース** | Aurora cluster identifier | RDSクラスターと紐付ける場合に選択 |

---

## 自動ローテーション設定

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **自動ローテーションの有効化** | 有効 / 無効 | セキュリティ要件に応じて設定 |
| **ローテーション間隔** | 30日 / 60日 / 90日 / カスタム | 推奨は30日または60日 |
| **ローテーション関数** | SecretsManagerRDSPostgreSQLRotationSingleUser | AuroraPostgreSQL用の組み込みLambda関数 |
| **ローテーション直後の実行** | 有効 / 無効 | 初回ローテーションをすぐに実行するか選択 |

---

## レプリケーション設定

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **レプリケーション有効化** | 有効 / 無効 | DR要件がある場合に設定 |
| **レプリケーション先リージョン** | ap-southeast-1 / us-east-1 など | 災害対策用のセカンダリリージョンを指定 |
| **レプリケーション先KMSキー** | リージョン別のKMS Key ID | 各リージョンで異なるKMSキーが必要 |

---

## VPCエンドポイント設定 (Private Link利用時)

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **VPCエンドポイント使用** | 検討中 / 使用する / 使用しない | Private Link経由でアクセスする場合に設定 |
| **VPC ID** | vpc-xxxxxxxxxxxxxxxxx | VPC: 10.0.0.0/16 |
| **サブネット** | subnet-xxxxxxxx (10.0.1.0/24-1a), subnet-yyyyyyyy (10.0.2.0/24-1c) | Private Subnetを使用する場合は別途作成が必要 |
| **セキュリティグループ** | sg-xxxxxxxxxxxxxxxxx | ポート443を許可するSGを作成・アタッチ |
| **エンドポイントサービス名** | com.amazonaws.ap-northeast-1.secretsmanager | 東京リージョンのSecrets Managerエンドポイント |
| **プライベートDNS有効化** | 有効 | 有効化推奨(アプリケーションコード変更不要) |

---

## アクセス制御設定

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **リソースポリシー** | 必要に応じて設定 | クロスアカウントアクセスが必要な場合に設定 |
| **IAMポリシー (GetSecretValue)** | 必要なIAMロール/ユーザーに付与 | EC2、ECS、Lambda等にアタッチ |
| **タグベースのアクセス制御** | 環境別タグで制御 | 例: Environment=Production |

---

## タグ設定

| キー | 値 | 備考 |
|------|-----|------|
| Name | `aurora-postgres-serverless-db-credential` | シークレット名と同一推奨 |
| Environment | Production / Staging / Development | 環境識別用 |
| Application | アプリケーション名 | 利用するアプリケーション名 |
| ManagedBy | Terraform / CloudFormation / Manual | 管理方法を明記 |
| CostCenter | コストセンターコード | コスト配賦用 |
| Owner | チーム名または担当者 | 責任者情報 |

---

## モニタリング・アラート設定

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **CloudWatch Logs有効化** | 有効 | API呼び出しログを記録 |
| **CloudTrail統合** | 有効 | すべてのAPI操作を監査ログとして記録 |
| **CloudWatch Alarms** | 設定推奨 | 異常なアクセスパターンを検知 |
| **SNS通知先** | メールアドレス or Slackチャンネル | ローテーション失敗時の通知先 |

---

## セキュリティ要件

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **最小権限の原則** | 適用 | 必要最小限のIAM権限のみ付与 |
| **暗号化** | 保管時・転送時ともに暗号化 | KMS使用(デフォルトまたはカスタム) |
| **監査ログ保持期間** | 90日以上 | コンプライアンス要件に応じて設定 |
| **アクセス元IP制限** | VPCエンドポイント経由のみ許可 | Private Link使用時に制限可能 |

---

## バックアップ・復旧

| 項目 | 設定値 | 備考 |
|------|--------|------|
| **バージョン管理** | 自動有効 | Secrets Managerは自動でバージョン管理 |
| **バージョン保持数** | 制限なし | 削除スケジュール設定まで保持される |
| **削除保護** | 7〜30日間の復旧期間設定 | 誤削除防止のため復旧期間を設定推奨 |

---

## コスト見積もり

| 項目 | 料金 | 備考 |
|------|------|------|
| **シークレット保存料金** | $0.40/シークレット/月 | 1シークレットあたりの月額料金 |
| **APIコール料金** | $0.05/10,000リクエスト | GetSecretValue等のAPI呼び出し |
| **レプリケーション料金** | レプリケーション先ごとに$0.40/月 | マルチリージョン構成時 |

---

## 注意事項・チェックリスト

- [ ] シークレット名は環境・用途が識別できる命名規則に従っているか
- [ ] パスワードの複雑性要件を満たしているか(最小8文字、英数字記号含む)
- [ ] 自動ローテーションを有効化する場合、Lambda関数がRDSにアクセス可能なネットワーク構成か確認
- [ ] Private Link使用時は、Private SubnetとNAT Gatewayまたはインターネットゲートウェイなしでのアクセスを確認
- [ ] IAMロール/ポリシーで必要最小限の権限(GetSecretValue)のみ付与されているか
- [ ] CloudTrailでAPI操作の監査ログが有効化されているか
- [ ] 本番環境ではカスタムKMSキーの使用を検討(キーローテーション、アクセス制御強化)
- [ ] タグ設定は組織の標準に準拠しているか
- [ ] 削除保護期間を設定し、誤削除を防止する設定になっているか
- [ ] コスト最適化のため、不要なAPIコールを削減する実装になっているか(キャッシュ利用等)

---

## 作成手順メモ

1. AWS Management Console → Secrets Manager に移動
2. 「新しいシークレットを保存」をクリック
3. 上記パラメータシートに従って各項目を入力
4. タグを設定
5. レビュー後、「保存」をクリック
6. VPCエンドポイント作成(Private Link使用時)
7. IAMポリシーを関連リソースにアタッチ
8. CloudWatch/CloudTrailでモニタリング設定
9. 動作確認(シークレット取得テスト)

---

**作成者:** ____________________  
**承認者:** ____________________  
**作成日:** ____________________