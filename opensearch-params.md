# AWS OpenSearch 構築パラメータシート

## 基本設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| ドメイン名 | Domain name | [ドメイン名を入力] | 小文字、数字、ハイフン(-)のみ使用可能。3?28文字 |
| リージョン | Region | ap-northeast-1 (Tokyo) | 東京リージョン |
| デプロイタイプ | Deployment type | Production / Dev/Test | 本番環境はProduction推奨 |
| バージョン | Engine version | OpenSearch [バージョン] | 最新の安定版(2025/11/1時点 3.1)を推奨 |

## ネットワーク設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| ネットワーク構成 | Network | VPC access | パブリックアクセスまたはVPCアクセス(推奨)を選択 |
| VPC | VPC | 10.0.0.0/16 | 既存VPCを選択 |
| サブネット(AZ-1a) | Subnet | 10.0.1.0/24 | ap-northeast-1a |
| サブネット(AZ-1c) | Subnet | 10.0.2.0/24 | ap-northeast-1c |
| セキュリティグループ | Security group | [セキュリティグループID] | ポート443を許可する設定が必要 |

## データノード設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| インスタンスタイプ | Instance type | [例: r6g.large.search] | ワークロードに応じて選択 |
| ノード数(初期) | Number of nodes | [数値] | マルチAZ構成の場合は偶数推奨 |
| オートスケーリング | Auto-Scaling | 有効 | - |
| 最小ノード数 | Minimum nodes | [最小値] | 最低2ノード推奨(冗長性確保) |
| 最大ノード数 | Maximum nodes | [最大値] | 想定される最大負荷を考慮 |
| ストレージタイプ | Storage type | EBS / Instance store | 本番環境はEBS推奨 |
| EBSボリュームタイプ | EBS volume type | gp3 / io1 | gp3が推奨(コストパフォーマンス良好) |
| EBSボリュームサイズ | EBS volume size | [GB] | データ量 + 20%の余裕を確保 |
| スループット | Throughput (gp3) | [MiB/s] | gp3選択時のみ設定可能(125-1000) |
| IOPS | IOPS | [数値] | gp3: 3000-16000, io1: 最大64000 |

## 専用マスターノード設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| 専用マスターノード | Dedicated master nodes | 有効 / 無効 | 本番環境では有効推奨 |
| インスタンスタイプ | Master instance type | [例: r6g.large.search] | データノードより小さいインスタンス可 |
| マスターノード数 | Master node count | 3 | 3または5を推奨(奇数) |

## ウォームノード設定(オプション)

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| ウォームノード | Warm nodes | 有効 / 無効 | 古いデータ保存用(UltraWarm) |
| インスタンスタイプ | Warm instance type | [例: ultrawarm1.medium.search] | - |
| ウォームノード数 | Warm node count | [数値] | 2以上推奨 |

## スナップショット設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| 自動スナップショット時刻 | Automated snapshot hour | [0-23時] | UTCで指定(日本時間-9時間) |

## アクセスポリシー設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| アクセスポリシー | Access policy | JSON形式 | IAMロールまたはIPベースで設定 |
| きめ細かなアクセス制御 | Fine-grained access control | 有効 / 無効 | 有効推奨(ユーザー単位の制御) |
| マスターユーザー | Master user | IAM ARN / 内部ユーザー | 内部ユーザーの場合はユーザー名/パスワード設定 |
| SAML認証 | SAML authentication | 有効 / 無効 | エンタープライズ環境で検討 |

## 暗号化設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| 保管時の暗号化 | Encryption at rest | 有効 | 本番環境では必須 |
| KMSキー | KMS key | AWS管理 / カスタマー管理 | カスタマー管理でより細かい制御可能 |
| Node-to-node暗号化 | Node-to-node encryption | 有効 | 有効推奨 |
| HTTPSの必須化 | Require HTTPS | 有効 | 必須 |
| TLS最小バージョン | Minimum TLS version | TLS 1.2 / 1.3 | TLS 1.2以上推奨 |

## 高度な設定

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| 証明書 | Certificate | ACM証明書ARN | カスタムエンドポイント使用時必須 |


## タグ設定

| 項目 | キー | 値 | 備考 |
|------|-----|-----|------|
| タグ1 | Name | [ドメイン名] | リソース識別用 |
| タグ2 | Environment | Production/Staging/Dev | 環境識別用 |
| タグ3 | Owner | [所有者/チーム名] | 管理責任者 |
| タグ4 | CostCenter | [コストセンター] | コスト配分用 |

## オートスケーリングポリシー詳細

| 項目 | パラメータ | 設定値 | 備考 |
|------|-----------|--------|------|
| スケーリング対象 | Scaling target | Storage / CPU / Memory | 複数選択可能 |
| ストレージ使用率閾値 | Storage threshold | [%] | 推奨: 75-80% |
| CPU使用率閾値 | CPU threshold | [%] | 推奨: 70-80% |
| メモリ使用率閾値 | Memory threshold | [%] | 推奨: 70-80% |
| クールダウン期間 | Cool down period | [分] | デフォルト: 15分 |

## 注意事項

1. **コスト最適化**: インスタンスタイプとノード数はワークロードに応じて適切に設定する。
2. **セキュリティ**: VPCアクセスの場合、セキュリティグループで必要最小限のアクセスのみ許可する。
3. **バックアップ**: 自動スナップショット以外に、手動スナップショットも定期的に取得する。（手動の必要性、検討）
4. **マルチAZ**: 本番環境では必ず複数のAZにノードを分散配置する。
5. **モニタリング**: CloudWatch Alarmを設定し、異常を早期検知できるようにする。（必要性、検討）
6. **バージョン管理**: OpenSearchのバージョンアップグレードは計画的に実施する。（過去事例の調査）
7. **オートスケーリング**: 急激な負荷増加が予想される場合は、事前に手動でスケールアップを検討。（手動の必要性、検討）