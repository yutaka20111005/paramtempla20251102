# AWS ElastiCache (Redis) 構築パラメータシート

## クラスター設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| クラスターモード | 無効 | 無効の場合はレプリケーショングループ、有効の場合はシャーディング可能 |
| クラスター名 | - -prod-redis-cluster | 例: myapp-redis-cluster (英数字とハイフン、63文字以内) |
| 説明 | | クラスターの用途を記載 |

## エンジン設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| エンジン | Redis | |
| エンジンバージョン | 7.1 | 例: 7.1、最新の安定版推奨 |
| ポート | 6379 | デフォルトポート、変更する場合は6380などを指定 |
| パラメータグループ | default.redis7 | default.redis7 または カスタムパラメータグループ名を記載 |

## ノード設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| ノードタイプ | cache.r6g.xlarge | 性能要件、負荷試験結果、モニタリング結果に応じて選択 |
| レプリカ数 | 2 | 合計: 3ノード（プライマリ1 + レプリカ2） |
| Multi-AZ | 有効 | 自動フェイルオーバーが有効化される |

## シャード設定 (クラスターモード有効時のみ)
| 項目 | 設定値 | 備考 |
|------|--------|------|
| シャード数 | － | クラスタモード無効の場合、シャード数の概念無し |
| シャードあたりのレプリカ数 | － | クラスタモード無効の場合、シャード数の概念無し |

## ネットワーク設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| VPC | 10.0.0.0/16 | 既存VPCを選択 |
| サブネットグループ名 | | 事前に作成したサブネットグループ名を記載 |
| サブネット (AZ-1a) | 10.0.1.0/24 | ap-northeast-1a |
| サブネット (AZ-1c) | 10.0.2.0/24 | ap-northeast-1c |
| サブネット (AZ-1d) | 10.0.3.0/24 | ap-northeast-1d |
| 優先アベイラビリティゾーン | 配置なし | または特定のAZを指定 |

## セキュリティ設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| セキュリティグループ | - - -sg-redis | Redis用のセキュリティグループIDを記載 (例: sg-xxxxxxxxx) |
| インバウンドルール | TCP 6379 | アプリケーションサーバーのセキュリティグループから許可 |
| 暗号化(保管時) | 有効 | 本番環境では有効推奨 |
| 暗号化(転送時) | 有効 | 本番環境では有効推奨。有効時はTLS対応が必要 |

## 認証設定（Private subnet/SecurityGroupによる制御を行うため、認証設定は行わない想定）
| 項目 | 設定値 | 備考 |
|------|--------|------|
| Redis AUTH | 有効/無効 | セキュリティ強化のため有効推奨(生成AI返答)。Private Subnet + SGのみの場合は無効も可 |
| AUTH トークン | | 有効時は16文字以上の複雑なパスワードを設定 |

## バックアップ設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| 自動バックアップ | 有効 | RPO要件に応じて設定(RPO、RTO　要確認) |
| バックアップ保持期間 | 7日 | 例: 7日間 (1-35日で指定可能) |
| バックアップウィンドウ | 12:00-13:00 (UTC) | 例: 03:00-04:00 (UTC)、業務への影響が少ない時間帯を選択 |
| 最終バックアップスナップショット | 作成する | クラスター削除時のスナップショット保持 |

## メンテナンス設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| メンテナンスウィンドウ | sun:08:00-sun:09:00 (UTC) | 例: sun:17:00-sun:18:00 (UTC)、業務への影響が少ない時間帯を選択 |
| SNS通知トピック | ー | イベント通知用のSNSトピックARNを記載 (オプション) |

## Auto Scaling 設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| Auto Scaling | 有効 | レプリカ数の自動スケーリング |
| 最小レプリカ数 | 1 |  |
| 最大レプリカ数 | 5 |  |
| ターゲットメトリクス | Database Memory Usage Counted for Evict Percentage | 例: Database Memory Usage Counted for Evict Percentage |
| ターゲット値 | 70% |  |

## ログ設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| スローログ | 無効 | パフォーマンス分析用に必要な場合「有効」 |
| スローログ配信先 | ー　| CloudWatch Logs または Kinesis Data Firehose |
| エンジンログ | 無効 | トラブルシューティング用に必要な場合「有効」 |
| エンジンログ配信先 | ー | CloudWatch Logs または Kinesis Data Firehose |

## タグ設定
| キー | 値 | 備考 |
|------|-----|------|
| Name | - -prod-redis | 例: myapp-redis-cluster |
| Environment | prod | 例: prd/stg/dev |
| Application |  | 例: myapp |
| CostCenter | | コスト配分用 |
| ManagedBy | terraform |  |

## 追加設定
| 項目 | 設定値 | 備考 |
|------|--------|------|
| データ階層化 | 無効 | r6gdノードタイプでのみ利用可能。コスト削減に有効 |
| 通知 | (SNSトピックARNを記載) | SNS通知設定 (障害、メンテナンス通知用) <br> 事前にSNS作成が必要。通知先メール(例): xxx@example.com |

## 接続情報 (作成後に記載)
| 項目 | 設定値 | 備考 |
|------|--------|------|
| プライマリエンドポイント | （作成後記載） | 作成後に自動生成されるエンドポイントを記載 |
| リーダーエンドポイント |（作成後記載） | 読み取り専用エンドポイント (レプリカ有効時) |
| 設定エンドポイント | (導入時、無効を想定) | クラスターモード有効時 |

## 注意事項
- **サブネットグループは事前作成が必要**: コンソールでElastiCache用のサブネットグループを事前に作成。
- **セキュリティグループの設定**: アプリケーションからのアクセスのみ許可するよう適切に設定する。
- **暗号化設定**: 作成後は変更できないため、初期設定時に慎重に決定する。
- **バックアップウィンドウ**: メンテナンスウィンドウと重ならないように設定する。
- **コスト**: ノードタイプとレプリカ数によってコストが大きく変動する。AWS料金計算ツールで事前見積もりを推奨。
- **バージョンアップグレード**: メンテナンスウィンドウ内に自動で実行される場合がある。
- **Multi-AZ**: 自動フェイルオーバーには若干の切り替え時間が発生する。 (通常数秒〜数分)
- **認証設定**: Private Subnet + Security Groupでアクセス制限している場合は無効でも可。本番環境では多層防御の観点から有効化推奨（生成AI返答）
